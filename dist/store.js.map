{"version":3,"sources":["src/store.js"],"names":[],"mappings":"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","file":"dist/store.js","sourcesContent":["(function() {\n  'use strict'\n\n  angular.module('modelStore', [])\n    .service('Store', ['$rootScope', 'thaw', ($rootScope, thaw) => {\n      var thawInst,\n          modelCache = {},\n          anonIndex  = 0\n\n      return class Store {\n        static __modelCache__() {\n          return modelCache\n        }\n\n        constructor(modelName = null) {\n          var model\n\n          // Check for modelName or assign anonId\n          this.modelName = modelName ? modelName : this._anonId(anonIndex++)\n          model = modelCache[this.modelCacheId()]\n\n          // Return the model if already exists\n          if (model)\n            return model\n\n          this._usersListening = []\n\n          // Set up Object.observe so we can keep the modelCache updated\n          // without thinking about it\n          if (modelName)\n            Object.observe(this, this.__objectChanged__)\n\n          // Store current object in modelCache\n          modelCache[this.modelCacheId()] = this\n\n          // Init function to be extended\n          this.init()\n\n          // cannot specify return so need to just assume object\n          //is immutable and can only call functions\n        }\n\n        // Init function to overload\n        init() {\n          return this._filterFunctions()\n        }\n\n        // Listen to all changes on model\n        listen(callback) {\n          // Add callback to the current classes cache in modelCache\n          modelCache[this.modelCacheId()]._usersListening.push(callback)\n        }\n\n        // Emit events along scopes\n        emit(eventName = this.modelCacheId(), data = this) {\n          // Broadcast events through the application scope only\n          // passes a deep copy of the data\n          $rootScope.$broadcast(eventName, this._filterData(data))\n        }\n\n        // Id of model cache used for caching and default event names\n        modelCacheId(name = this.modelName) {\n          return `${this._className()}:${name}`\n        }\n\n        _className(object = this) {\n          return object.constructor.name\n        }\n\n        _anonId(index) {\n          return `ANON:${index}`\n        }\n\n        _anonCallbacks() {\n          var anonCallbacks = []\n\n          for (let i = 0; i <= anonIndex; i++) {\n            let model = modelCache[this.modelCacheId(this._anonId(i))]\n\n            if (model)\n              anonCallbacks = anonCallbacks.concat(model._usersListening)\n          }\n\n          return anonCallbacks\n        }\n\n        _filterData(data = this) {\n          var cloneData = {}\n\n          for (let [key, value] of Object.entries(data))\n            if (key[0] !== '_' && typeof value !== 'function')\n              cloneData[key] = angular.copy(value)\n\n          return cloneData\n        }\n\n        _filterFunctions(data = this) {\n          var functionSet = {}\n\n          for (var key in data)\n            if (typeof data[key] === 'function' && key.substr(0, 2) !== '__')\n              functionSet[key] = angular.copy(data[key])\n\n          return functionSet\n        }\n\n        __objectChanged__(changes) {\n          var self = this,\n              changedModels = {}\n\n          thaw(changes, {\n            each: (i) => {\n              let change = changes[i].object\n              changedModels[change._className()] = change\n            },\n\n            done: () => {\n              for (let key in changedModels)\n                changedModels[key].__processCallbacks__()\n            }\n          })\n        }\n\n        __processCallbacks__(model = this) {\n          var allCallbacks = model._usersListening.concat(model._anonCallbacks())\n\n          thaw(allCallbacks, {\n            each: (i) => {\n              allCallbacks[i](model.modelCacheId(), model._filterData())\n            },\n\n            done: () => {\n              modelCache[model.modelCacheId()] = model\n            }\n          })\n        }\n      }\n    }])\n})()\n"]}